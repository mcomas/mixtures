%\documentclass[preprint, review, 3p, authoryear]{elsarticle}
\documentclass[12pt, a4paper]{article}

\usepackage{setspace}
\usepackage[utf8]{inputenc}
\usepackage{amsmath, amssymb, amsthm}
\usepackage{xcolor}
\usepackage{graphicx}
\usepackage[authoryear]{natbib}
\usepackage{apalike}

%%%%% bold symbol in math enviornment
\newcommand{\m}[1]{\boldsymbol{#1}}

\DeclareMathOperator*{\argmax}{arg\,max}

\newtheorem{prop}{Proposition}
\newtheorem{definition}{Definition}

\title{Logratio methods in mixture models for compositional data sets}
\author{M. Comas-Cufí \and J.A. Martín-Fernández \and G. Mateu-Figueras}

\doublespacing
\begin{document}


\maketitle
%\begin{frontmatter}

%\title{Logratio methods in mixture models for compositional data sets}

%\journal{Computational Statistics and Data Analysis}
% \author[imae]{M. Comas-Cufí}
% \ead{mcomas@imae.udg.edu}
% \author[imae]{J.A. Martín-Fernández\corref{cor2}}
% \ead{josepantoni.martin@udg.edu}
% \author[imae]{G. Mateu-Figueras}
% \ead{gloria.mateu@udg.edu}
% \cortext[cor2]{Corresponding author. Dept. Computer Science, Applied Mathematics and Statistics (UdG), Campus Montilivi (P4), E-17071 Girona, Spain. Tel.: +34 972 418426, Fax: +34 972 418792}
% \address[imae]{Department of Computer Science, Applied Mathematics and Statistics,\\ University of Girona, Spain}


\begin{abstract}
%% Text of abstract
Finite mixtures of multivariate distributions have shown increasing importance in recent years. New algorithms and software implementation facilitate its application in clustering, discriminant analysis and density estimation. 
However, misleading and incoherent results can be obtained when traditional statistical methods are applied to compositional data. This type of data has a constrained sample space, the simplex, with its particular algebraic-geometric structure. The log-ratio methodology has proven to be appropriate to analyse compositional data. In this paper, traditional strategies to fit a mixture model in compositional data sets are revisited and the most important difficulties are detailed. Afterwards, a new proposal using mixture of distributions defined on log-ratio coordinates is introduced. An analysis of a real data set is presented to illustrate abd compare the different methodologies.

{\bf Keywords:} Compositional data, Finite Mixture, Log ratio, Model-based clustering, Normal distribution, Orthonormal coordinates, Simplex
\end{abstract}



% \begin{keyword}
% Compositional data \sep
% Finite Mixture\sep
% Log ratio\sep
% Model-based clustering \sep
% Normal distribution\sep
% Orthonormal coordinates\sep
% Simplex
% \end{keyword}

%\end{frontmatter}

%%
\section{Introduction}

\noindent  A \emph{finite mixture distribution} is a probability distribution with probability density function (pdf) given by the expression
\begin{equation}\label{mixt}
\pi_1 f_1(\;\cdot\; ; \m\theta_1) + \dots + \pi_k f_k(\;\cdot\; ; \m\theta_k),
\end{equation}
where $f_1, \dots, f_k$ are pdf's of distributions with parameters $\m\theta_1, \dots, \m\theta_k$ respectively, and $\pi_1, \dots, \pi_k$ are positive numbers with $\sum_{i=1}^k \pi_i = 1$. The pdfs $f_1, \dots, f_k$ are called \emph{components}. In this paper, we assume the most common case where all the components, $f_i$, in a mixture belong to a unique family (Gaussian, skew-normal, etc) with pdf, $f$, and parameters $\m\theta_1, \dots, \m\theta_k$ belonging to a unique set $\Theta$. 

According to \cite{scott1971clustering} and \cite{mclachlan2000finite}, finite mixture models provide reasonable results in several multivariate techniques, e.g. model-based clustering, discriminant analysis and density estimation. The Gaussian mixture is the most common model due to its theoretical and computational simplicity \citep{mclachlan2000finite}. 
However, because of its simplicity, Gaussian mixtures have some important limitations 
that originated the proposal of alternative models. For example, $t$-student mixtures were introduced to fit distributions with heavier tails \citep{andrews2012model, lee2013finite, lin2010robust}; and skew-normal and skew-$t$ mixtures were proposed to fit asymmetrical distributions \citep{lee2011fitting}. Moreover, \cite{browne2013mixture} introduced the Generalized Hyperbolic mixture, a more general mixture model which includes, either asymptotically or explicitly, different type of well-known families of mixture models. A crucial point we want to note is that all these mixtures models were designed for data in real space. For data living in a different sample space, there is a general agreement that other distributions should be used. 
For example, \cite{bickel2004multi} used multinomial mixture distributions for discrete data in text classification, and  
 \cite{bouguila2011count} proposed other extensions of multinomial mixture distributions for count data. 
Another example is circular data, whose sample space is the sphere.  \cite{banerjee2005clustering} and \cite{mardia2007protein} proposed mixtures of Von Mises probability distributions, defined for random vectors in the sphere.

Finite mixture modelling for compositional data (CoDa) also needs its own mixture distributions because this type of data has a particular sample space: the simplex $\mathcal{S}^D$ with a different algebraic geometric structure from real space (see Section~\ref{coda_section}).
CoDa, also called $D$-part compositions, are vectors $\textbf{x} = (x_1, x_2, ..., x_D)$ with all its components strictly positive  and carrying only relative information. A $D$-part composition is usually restricted to sum a fixed constant $\kappa$, i.e.
\begin{equation}
\sum_{i=1 }^D x_i = \kappa.
\label{sum_to_constant}
\end{equation}
As a convention, it is usual to assume $\kappa =1$ for proportions and $\kappa = 100$ for percentages. Because the value of $\kappa$ is irrelevant, in this paper we will assume that $\kappa = 100$ for simplicity. Typical examples of CoDa are frequent in economy (income/expenditure distribution), medicine (body composition: fat, bone, muscle), food industry (food composition: fat, sugar, …), geochemistry and chemometrics (chemical composition), ecology (abundance different species), sociology (time-use surveys), and genetics (genotype frequency). 
When a problem is compositional, one is assuming that the absolute value of each part is irrelevant and the interest is focused on the ratios of the parts. Following this idea, \cite{aitchison1986statistical} introduced the log-ratio methodology to deal with compositional data. According to this methodologythe compositions are expressed in terms of log-ratio coordinates and the traditional techniques are applied to them.

As in many other statistical methods, log-ratio requires complete data sets. When measuring concentrations, often some elements are not present in sufficient concentrations and measuring instruments report them as values below detection limits. In the literature this issue is also known as the rounded zero problem. The imputation strategies complete a data matrix, replacing non-detected values by reasonable estimates, allowing the computation of any log-ratio and any multivariate data analysis. The interested reader can refer to \cite{palarea2014compositional}, who encompass the recent advances in this area.


In the past, only few works \citep[e.g.,][]{albert1982mixtures, bouguila2004unsupervised} introduced finite mixtures models using Dirichlet distributions, a traditional probability distribution on the simplex. In consequence, there is a gap in the analysis of CoDa where last advances in log-ratio methods can contribute to mixture modelling. In the present work, following \cite{mateu2013normal}, we introduce a new technique to model CoDa using mixtures of distributions well-defined on the simplex using log-ratio coordinates and some well known families of distributions (Gaussian, $t$, skew, ...).

. The technique allows to model CoDa using the broad range of families of distributions defined on the real space (Gaussian, t-distribution, skew, ...).

This paper is organized as follows: in Section~\ref{coda_section} a brief introduction of compositional data analysis is provided. Section~\ref{standard_section} describes the pros and cons of each traditional mixture models when are applied to compositional data. Section~\ref{codamix_section} is devoted to introduce log-ratio mixture models. A real data set is analyzed in Section~\ref{example_section} to illustrate the new methods. Finally, Section~\ref{conclusion_section} contains conclusions and final remarks. The programming of the data analyses discussed in this work has been conducted using the open-source R statistical environment \citep{R2014soft}. Computer routines implementing the methods can be obtained from the R package \texttt{Mclust}, \texttt{Rmixmod}, \texttt{EMMIXuskew} and also from the website http://www.compositionaldata.com.


%%%
%%% Fent referència als dos paràgrafs anteriors, en aquest paràgraf es presentaran les mixtures en un espai composicional.




\section{Compositional data analysis}
\label{coda_section}


 \noindent \cite{aitchison1986statistical} stated that  there are two basic operations in the simplex $\mathcal{S}^D$: \emph{perturbation} ($\oplus$) and 
 \emph{powering} ($\odot$). The \emph{perturbation} is defined between two compositions $\textbf{x}$ 
and $\textbf{y}$,  and the \emph{powering} is defined between a composition $\textbf{x}$ and a scalar value $\alpha$ as

\begin{equation}
\textbf{x} \oplus \textbf{y} =  C( x_1 y_1, \dots, x_D y_D) \qquad\qquad \alpha
 \odot \textbf{x} =  C( {x_1}^\alpha, \dots, {x_D}^\alpha),
\label{pert_pow}
\end{equation}
where $C(\textbf{x})=\frac{\kappa}{\sum x_k}(x_1, \dots, x_D) $ is the closure operation for rescaling a vector.

These operations respectively play analogous roles to translation and scalar multiplication in $\mathbb{R}^D$, and provide a vector space
structure of dimension $D-1$ to the simplex. \cite{pawlowsky2001geometric} stated that the inner product 
\begin{equation}
<\textbf{x}, \textbf{y}>_a = \frac{1}{D} \sum_{i < j} \ln \frac{x_i}{x_j} \ln \frac{y_i}{y_j}
\label{inner_prod}
\end{equation}
 provides to $\mathcal{S}^D$ the structure of an Euclidean space of dimension $D-1$. Note that a norm and a distance can be derived from the inner product.
This Euclidean space structure sallows us to establish the principle of working on coordinates \citep{figueras2011principle}. The idea is to express compositions in terms of its coordinates with respect to an orthonormal basis on $\mathcal{S}^D$ and apply
traditional statistical methods to these coordinates. These coordinates are formed by log-ratios, therefore we use the log-ratio methodology mentioned above.Once an orthonormal basis $\mathcal{B} = \{\textbf{v}_1, \dots, \textbf{v}_{D-1}\}$ is fixed, any $D$-part composition $\textbf{x}$ can be expressed as the linear combination
\[
\textbf{x} = (h_1 \odot \textbf{v}_1)\; \oplus \dots  \oplus (h_{D-1} \odot \textbf{v}_{D-1}).
\]

The elements of vector $h_\mathcal{B}(\textbf{x})=(h_1, \dots, h_{D-1})$ are the orthonormal log-ratio coordinates of composition $\textbf{x}$ respect to the basis $\mathcal{B}$. \cite{egozcue2003isometric} introduced an example of these coordinates where

\begin{equation}
\label{eilr}
h_i=\sqrt{\frac{i}{i+1}}\,\ln\frac{\sqrt[i]
{\prod_{j=1}^{i} x_j}}{x_{i+1}},\,i=1,\dots,D-1,
\end{equation}
whose corresponding basis is $\mathcal{B} = \{\textbf{v}_1, \dots, \textbf{v}_{D-1}\}$ with

\[
\textbf{v}_i = C\Big( \underbrace{e^{1/\sqrt{i(i+1)}}, \dots, e^{1/\sqrt{i(i+1)}}}_{i}, 1/e^{\sqrt{ i/(i+1)}}, \underbrace{1, \dots, 1}_{D-(i+1)} \Big).
\]

% Note that log-ratio methodology requires positive entries in data matrix. Zeros values present in the data should be
% preprocessed with specific techniques \citep[e.g.,][]{M+12}.

One can define a pdf on the simplex by a pdf over the vector of orthonormal log-ratio coordinates. Indeed, let $f^*(\cdot \;; \m\theta) : \mathbb{R}^{D-1} \rightarrow \mathbb{R}^+$ be a pdf defined on real space with parameters $\m\theta$. Then, $f_\mathcal{B}(\mathbf{x}\;; \m\theta) = f^*(h_\mathcal{B}(\textbf{x})\;; \m\theta)$ defines a pdf on the simplex, $f_\mathcal{B}(\;\cdot\;; \m\theta): \mathcal{S}^D \rightarrow \mathbb{R}^+$, with respect to Aitchison measure on $\mathcal{S}^D$, a measure compatible with the Euclidean vector space structure of $\mathcal{S}^D$ (see \cite{mateu2013normal} for details). For example, fixed an orthonormal basis $\mathcal{B}$, the log-ratio normal distribution with parameters $\mbox{\boldmath \(\mu\)}$ and $\mathbf{\Sigma}$ is defined as

\begin{equation}\label{eq:densSNormal}
f_\mathcal{B}(\mathbf{x}\;; \m\mu, \m\Sigma) =(2\pi)^{-(D-1)/2} |\mathbf{\Sigma}|^{-1/2} \exp \left( -{\frac{1}{2}} \left(h_\mathcal{B}(\textbf{x})- \m\mu \right)' \mathbf{\Sigma}^{-1} \left( h_\mathcal{B}(\textbf{x})- \m\mu \right)\right).
\end{equation}

Figure \ref{fig01}(left) shows  contour lines of three normal distributions on the simplex. Note that distribution in the centre of the ternary diagram is the more similar to elliptical contour lines in real space. However, note that as far is
the distribution form the center of the space as more different from the traditional Gaussian shape are the contours. These shapes are frequent in real data sets from industrial and scientific applications \citep{buccianti2011natural,vives2014individual}.
When these distributions are plotted using its coordinates (Fig.\ref{fig01}(right)) the traditional Gaussian contour lines are obtained. This idea can be applied using other distributions on real space as for example the skew-normal (see \cite{mateu2007skew}).


\begin{figure}[thbp]
\begin{center}
\begin{tabular}{cc}
 %   Simplex $\simplex^D$ & $\Longrightarrow$ &Coordinates in $\RR^{D-1}$\\
  \includegraphics[trim=0cm 0cm 0cm 0cm,width=\textwidth]{figures/ilr_coordinates.pdf} \\
 \end{tabular}
 \caption{Contour lines of typical log-ratio normal distribution on the simplex: (left) in the ternary diagram; (right) in coordinates. }\label{fig01}
\end{center}
\end{figure}


%\section{Mixtures on the simplex}

\section{Modelling compositional data mixtures using traditional distributions}
\label{standard_section}

\noindent Two different approaches have been used in the literature to model CoDa with finite mixtures. 
In the first approach,  the components are considered to be pdf defined on real space, that is, the nature of CoDa are ingnored. In the second approach,  authors realized that CoDa have a particular sample space and they proposed finite mixtures based on Dirichlet distribution and its generalizations.


\subsection{Finite mixtures using traditional distributions defined on the real space}
\label{real_section}

This approach assumes that $\mathcal{S}^D$ is a subset of $\mathbb{R}^D$ and its particular Euclidean space structure described in Section 2 is ignored \citep[see][]{papageorgiou2001model}. It is assumed that compositions  are generated from a finite mixture distributions with pdf given by Equation~\ref{mixt} where $f(\;\cdot\;;\m\theta_i): \mathbb{R}^D \rightarrow \mathbb{R}^+$ is a pdf defined on the real space (e.g., a multivariate normal distribution or a  $t$-student distribution). The main advantage of using this approach is the simplicity of working without considering the restriction that every component must be positive. However, this strategy exhibits some important limitations.

When one uses traditional distributions defined on the real space, the mixture pdf is strictly positive in all the space, giving positive probability to impossible events. For example, the \emph{impossible} event  of having the $i$-th component negative has positive probability, i.e $P(\{ \textbf{x} \in \mathcal{S}^D | x_i < 0 \}) > 0$. This difficulty is similar to the traditional confidence interval of a very small or very large proportion, it may respectively provide lower or upper limit beyond the restricted space. 

In addition, this approach defined on the real space also ignores the constant sum constraint. Therefore, another limitation is the collinearity that appears between components  after restricting the components to sum a constant (Eq. (\ref{sum_to_constant})). This collinearity implies that the covariance matrix is singular, and therefore, some methods can not be applied directly. Frequently, mixture models are estimated using the Expectation Maximization (EM) algorithm \citep{dempster1977maximum}. In the E-step of the EM-algorithm a pdf computed from the sample is evaluated. Because most pdf depend on the inverse of the covariance matrix (e.g., multivariate normal and multivariate skew), the common solution consists on removing one part from the composition for the rest of the analysis \citep{papageorgiou2001model}. However, this strategy may  produce misleading results.   


\begin{table}
\centering
\scriptsize
\input{tex/example-coda3-ilr3.tex}
\caption{CoDa set with three parts (a,b,c) from 20 compositions. ($h_1$,$h_2$) are its log-ratio coordinates.
Two categorical covariates were considered: site and condition. }
\label{example_elim_tab}
\end{table}

For example, let $\mathbf{X}$ be the CoDa data set recorded in Table \ref{example_elim_tab}. Suppose that compositions come from two different locations, $S_1$ and $S_2$. Moreover, suppose that compositions were collected under two possible weather conditions, $C_1$ and $C_2$. Suppose that it is well known
that these conditions only affects part $c$: in condition $C_1$ the level of element $c$ is lower than in condition $C_2$ (for example, suppose that element $c$ is water and condition $C_1$ is a sunny day while condition $C_2$ is a rainy day). In this way, the compositions from rows number 16 to 20 (Table  
\ref{example_elim_tab}) are the perturbed corresponding counterparts of compositions from the
rows number 11 to 15 after the perturbation $(1,1,r)$, where $r$ is a random number depending on condition $C_2$. In this example we have modelated $r$ as a lognormal random variable with parameters $\mu=2$ and $\sigma=0.25$. 
The ternary diagram in Figure \ref{example_elim_component} shows that $\mathbf{X}$ is formed by three groups: one group formed with the observations collected in site $S_1$ (filled circles), all of them collected under condition $C_1$; one group with observations collected in site $S_2$ under condition $C_1$ (empty circles) and another group with observations collected in site $S_2$ under condition $C_2$ (empty triangles).

\begin{figure}[thbp]
\centering
\includegraphics[trim=0cm 0cm 0cm 0cm,width=0.7\textwidth]{figures/example_ternary.pdf}
\caption{CoDa set $\mathbf{X}$ in the ternary diagram. Filled and empty symbols are respectively used for
data from location $S_1$ and $S_2$. Circles and triangles respectively corresponds to condition
$C_1$ and $C_2$. }\label{example_elim_component}
\end{figure}
Suppose that an analyst, who is interested in fitting a traditional mixture model to $\mathbf{X}$, is not informed about the two different weather conditions and he or she only knows the information about the location. Because 
the collinearity he/she decides to eliminate the part $c$ for the rest of the analysis. After eliminating component $c$, the researcher is working with the data set represented in Figure~\ref{example_elim_2_components}. This plot suggests that the analyst will conclude that mixture $\mathbf{X}$ is formed by three components according to the information collected only in the parts $(a, b)$. However, by construction, we know that attending the information in the parts $(a, b)$ the CoDa set $\mathbf{X}$ is formed only by two groups. That is, despite the part $c$ was eliminated, its effect (weather condition) is still present and interpretations based only in terms
of parts $(a, b)$ will be misleading.

\begin{figure}[thbp]
\centering
\includegraphics[trim=0cm 0cm 0cm 0cm,width=0.7\textwidth]{figures/example_2component.pdf}
\caption{Scatterplot of parts $(a,b)$ of CoDa set $\mathbf{X}$. Filled and empty symbols are respectively used for
data from location $S_1$ and $S_2$. Circles and triangles respectively corresponds to condition
$C_1$ and $C_2$.}\label{example_elim_2_components}
\end{figure}

\subsection{Models with traditional distributions defined on the simplex}
\label{simplex_section}

\noindent A finite mixture of distributions defined on the simplex is a probability distribution with pdf given by Eq.~\ref{mixt} where $f(\;\cdot\;;\m\theta): \mathcal{S}^D \rightarrow \mathbb{R}^+$, is a pdf defined on the simplex. The Dirichlet distribution is the traditional distributions on the Simplex. It can be obtained by the projection into the simplex of a random vector formed by independent and equally scaled gamma distributed components. 
Despite its simplicity and its good mathematical properties, it has a very strong independence structure \citep{aitchison1986statistical}. In particular, any ratio $x_i/x_j$ of two components have to be independent from another
ratio $x_k/x_m$ formed from other two components. In practice, such independence structure heavily restricts Dirichlet potential modelling application. Most of real CoDa sets have not this structure \citep{aitchison1986statistical}. To solve this difficulty, many generalizations of the Dirichlet distribution with less independence structure have been proposed: the Connor and Mosimann's distribution
\citep{connor1969concepts}, the scaled Dirichlet distribution \citep{aitchison1986statistical},  and the Liouville distribution \citep{rayens1994dependence}.  More recently, \cite{ongaro2008new} presented the Flexible Dirichlet distribution, but future
developments are required to discover its true potential application. Finally, \cite{monti2011shifted} introduced the Shifted-scaled Dirichlet distribution. This generalized distribution is defined adding the operations
perturbation and powering (Eq. \ref{pert_pow}) to the standard Dirichlet distribution. Unfortunately all these attempts
have limited success to fit the general dependence structure of CoDa.


In practice, given a CoDa set, there is no straightforward method to fit a Dirichlet mixture neither any of its generalizations. However, in the literature different methods are found to estimate the parameters of a Dirichlet. As the Dirichlet distribution is an exponential family, the log-likelihood function is globally concave and a global optimum can be obtained. According to \cite{ng2011dirichlet}, the MLE via Newton-Raphson algorithm converges to the global optimum. \cite{narayanan1991algorithm} provides a Fortran subroutine where three different possibilities are available to estimate the initial parameter required.
We can also obtain MLE estimates via the EM gradient methods \citep{ng2011dirichlet} or we can use a generalized method of moments
\citep{hansen1982large}.  
To obtain an approximation to the MLE estimator of a Dirichlet mixture, it is possible to apply the classification EM-algorithm \citep{celeux1992classification} using any of the described approaches to fit a Dirichlet model (see example in Section~\ref{example_section}).



\section{Modeling compositional data using a mixture of log-ratio distributions}
\label{codamix_section}

\noindent To model CoDa using a finite mixture of log-ratio distributions we consider 
\begin{equation}
\pi_1 f_\mathcal{B}(\;\cdot\; ; \m\theta_1) + \dots + \pi_k f_\mathcal{B}(\;\cdot\; ; \m\theta_k)
\label{codamixt}
\end{equation}
where $f_\mathcal{B}(\textbf{x} ; \m\theta_i)$ are pdf's on the simplex with parameters $\theta_i$. As it is indicated in Section~\ref{coda_section} and according to the principle of working on coordinates, we have that
\[f_\mathcal{B}(\textbf{x} ; \m\theta) = f^*(h_\mathcal{B}(\textbf{x}) ; \m\theta)\]
where $f^*(\;\cdot\; ; \m\theta_i)$ are pdf on $\mathbb{R}^{D-1}$ for the orthonormal log-ratio coordinates vectors $h_\mathcal{B}(\textbf{x})$. This approach is fully consistent with the particular nature of CoDa \citep{aitchison1986statistical}. Let $\mathbf{X} =  \{ \textbf{x}_1, \textbf{x}_2, \dots , \textbf{x}_n \}$ be a CoDa set. 
Thus fitting the parameters $\pi_1, \dots, \pi_k$ and $\m\theta_1, \dots, \m\theta_k$ of Equation~\ref{codamixt} using maximum likelihood estimators is equivalent to fitting the parameters in
\begin{equation}
\pi_1 f^*(\;\cdot\; ; \m\theta_1) + \dots + \pi_k f^*(\;\cdot\; ; \m\theta_k)
\label{coordmixt}
\end{equation}
using the data set $\mathbf{X}' = \{ h_\mathcal{B}(\mathbf{x}_1), \dots, h_\mathcal{B}(\mathbf{x}_n) \}$, that is, the log-ratio data set or equivalenty, the coordinates of our data set with respect to a selected orthnormal basis $\mathcal{B}$.

Indeed, the likelihood function evaluated for CoDa set $\mathbf{X}$ is
\begin{equation}\label{likeli1}
\prod_{i=1}^n \sum_{j=1}^k \pi_j f_\mathcal{B}(\textbf{x}_i; \m\theta_j)=\prod_{i=1}^n \sum_{j=1}^k \pi_j f^*(h_\mathcal{B}(\textbf{x}_i); \m\theta_j).
\end{equation}

Because the likelihood functions are the same,  the maximum likelihood estimators $\hat{\pi}_1, \dots, \hat{\pi}_k, \hat{\m\theta}_1, \dots, \hat{\m\theta}_k$ are also the same
\begin{eqnarray}\label{likeli2}
\left( \hat{\pi}_1, \dots, \hat{\pi}_k, \hat{\m\theta}_1, \dots, \hat{\m\theta}_k\right) = \argmax_{\pi_1, \dots, \pi_k, \m\theta_1, \dots, \m\theta_k} \prod_{i=1}^n \sum_{j=1}^k \pi_j f_\mathcal{B}(\textbf{x}_i; \m\theta_j) = \\ 
= \argmax_{\pi_1, \dots, \pi_k, \m\theta_1, \dots, \m\theta_k} \prod_{i=1}^n \sum_{j=1}^k \pi_j f^*(h_\mathcal{B}(\textbf{x}_i); \m\theta_j).
\end{eqnarray}


Following this approach, we cannot obtain the misleading results shown in section~\ref{real_section}. Taking the example from Section~\ref{real_section}, we were interested in fitting a mixture to a sample $\mathbf{X}$ formed by parts $a$, $b$ and $c$ (Table~\ref{example_elim_tab}). Instead of eliminating one component, now the analyst decides to express components $a$, $b$ and $c$ in log-ratio coordinates. Before starting the analysis, a basis $\mathcal{B}$ of $\mathcal{S}^3$ is selected, for example
\begin{equation}
\mathcal{B} = \left\{ C\Big( e^{1/\sqrt{2}}, 1/e^{\sqrt{1/2}}, 1 \Big), \; C\Big( e^{1/\sqrt{6}}, e^{1/\sqrt{6}}, 1/e^{\sqrt{2/3}} \Big) \right\},
\end{equation}
and the compositions of $\mathbf{X}$ are expressed in terms of its coordinates 
$\mathbf{X}'$ ($h_1 = \sqrt{1/2} \ln(a/b)$ and $h_2 = \sqrt{2/3} \ln(\sqrt{ab} / c)$) see Table~\ref{example_elim_tab}. Figure~\ref{example_ilr3} shows the plot of these coordinates where the different effect of the location (parts $a$ and $b$) and the weather conditions (part $c$) are highlighted. Note that the compositions from $S_2$ under condition $C_1$ take the same value that its counterparts from $C_2$ in the first coordinate. 



\begin{figure}[thbp]
\centering
\includegraphics[trim=0cm 0cm 0cm 0cm,width=0.7\textwidth]{figures/example_ilr3.pdf}
\caption{Scatterplot of log-ratio coordinates for the CoDa set $\mathbf{X}$. Filled and empty symbols are respectively used for data from location $S_1$ and $S_2$. Circles and triangles respectively corresponds to condition $C_1$ and $C_2$.}\label{example_ilr3}
\end{figure}

Note that in this case the interpretations based only in terms of parts $a$ and $b$ will not be misleading. In fact, if the analyst also decides to remove the part $c$ a basis $\mathcal{B}'$ of $\mathcal{S}^2$ is selected as
\begin{equation}
\mathcal{B}' = \left\{ C\Big( e^{1/\sqrt{2}}, 1/e^{\sqrt{1/2}} \Big) \right\}.
\end{equation}
In this way, the corresponding coordinate $h_1$ is the same as before. Figure~\ref{example_ilr2} 
shows the histograms of coordinate $h_1$ separated by weather conditions in two stratas. Note that, regardless the condition, all the data collected in $S_1$ take the same value forming one cluster (between -1 and 0). On the other hand, the compositions collected in $S_2$ are close to one.

\begin{figure}[thbp]
\centering
\includegraphics[trim=0cm 0cm 0cm 0cm,width=0.7\textwidth]{figures/example_ilr2.pdf}
\caption{Histograms of first log-ratio coordinate for CoDa set $\mathbf{X}$. Two stratas correspond to weather conditions.}\label{example_ilr2}
\end{figure}
% 
% %\textbf{v}_i = \frac{1}{s_i}\Big( \underbrace{e^{1/\sqrt{i(i+1)}}, \dots, e^{1/\sqrt{i(i+1)}}}_{i}, 1/e^{\sqrt{ i/(i+1)}}, \underbrace{1, \dots, 1}_{D-(i+1)} \Big) 
% \end{equation}
% %where $s_i =  i\,e^{1/\sqrt{i(i+1)}} + 1/e^{\sqrt{ i/(i+1)}} + D - (i+1)$


It is important to mention the invariance under chages of orthonormal basis for the fitted mixture. Note that in (\ref{likeli1}) (\ref{likeli2}) we fit our mixture using the coordinates $h_\mathcal{B}(\textbf{x})$ with respect to a specific basis $\mathcal{B}$ but any other orthnormal basis could have been chosen as well. Thus, in any compositional analysis involving coordinates, it is important to check the invariance of the results under changes of basis.

In our case, the fitted mixture are the same when a change of basis is applied. In particular, note that the log-ratio normal mixture model  (Eq.~\ref{eq:densSNormal}) is formulated in terms of Mahalanobis distance and of covariance matrix determinant, that are invariant under change of basis  \citep{barcelo1999comment}.

\section{A real data set: Forensic Glass}
\label{example_section}

\noindent To illustrate and compare the different approaches, we analyse the USA Forensic Science Service data set, also known as Forensic Glass data set. This data is available in UCI Machine Learning Repository \citep{uci2007repository}.  The data set is composed by  $214$ glass samples where the percentages of eight chemical elements were measured. In addition, we have information about a grouping variable with seven levels, which splits the glass samples in seven groups. For our purposes, we only consider three chemical elements: Calcium (Ca), Silica (Si) and Aluminium (Al); and three groups of glasses: containers, headlamps and vehicle windows. We call this dataset Reduced Forensic Glass data set (Table \ref{example_glasses}). Figure \ref{fig04} shows this data set formed by $59$ glass samples in the ternary diagram. Because the aluminum element takes small values the data set is close to the vertex of part Silica (Si), inside the shadow area. For better illustration, Figure \ref{fig04} includes a zoom of the shadow area.


\begin{table}
\centering
\scriptsize
\input{tex/example-glasses-A.tex}

%\input{tex/example-glasses-B.tex}
\caption{Reduced Forensic Glass data set: parts (Ca, Si, Al) and its log-ratio coordinates. 
The categorical covariate  (type) shows the provenance of glass.}
\label{example_glasses}
\end{table}

% \begin{table}
% \centering
% \scriptsize
% \input{tex/example-glasses-ilr-A.tex}
% \quad
% \input{tex/example-glasses-ilr-B.tex}
% \label{rgf_ilr}
% \caption{AQUESTA TAULA AFEGIR A LALTRA!!}
% \end{table}

\begin{figure}[htbp]
\centering
\includegraphics[width=0.95\textwidth]{figures/main_df.pdf}%{fig04_original_solution2.pdf}
\caption{Reduced Forensic Glass data set in ternary diagram: Calcium (Ca), Silica (Si) and Aluminium (Al) chemical elements. Three groups of glasses: containers (circles), headlamps (triangles) and vehicle windows (squares). The big ternary diagram is a zoom of the shadow area of the small ternary diagram.}
\label{fig04}
\end{figure}


To fit a traditional Gaussian mixture we eliminated the Calcium (Ca) component and used the standard R package \texttt{Rmixmod}. The corresponding mixture model obtained is
$
\pi_1 f(\;\cdot\; ; \mu_1, \Sigma_1) + \pi_2 f(\;\cdot\; ; \mu_2, \Sigma_2) + \pi_3 f(\;\cdot\; ; \mu_3, \Sigma_3)
$
with parameters

{\small \input{tex/pars1_component_elimination.tex} }


Figure~\ref{fig05component_elimination} (top-left) shows the isodensity curves for the fitted mixture of Gaussian distributions. The horizontal dashed line represents the limit of the simplex, i.e. the region were restrictions given by Equation~\ref{sum_to_constant} are held. In Figure~\ref{fig05component_elimination} (bottom-right) the isodensity curves have been completed to be represented in a ternary diagram. Note that the distribution is giving positive probability to impossible regions. Figure~\ref{fig05component_elimination} (top-right and bottom-left) also shows the isodensity curves of the finite mixture when the part removed was respectively Aluminium (Al) and Silica (Si)

\begin{figure}[htbp]
\includegraphics[width=0.8\textwidth]{figures/elim_component_all.pdf}
\caption{Reduced Forensic Glass data set. On the top-left, top-right and bottom-left isodensity curves for mixtures of Gaussian distributions in $R^{2}$ after removing the first, the second and the third component respectively. On bottom-right the isodensity curves transformed into the simplex.}
\label{fig05component_elimination}
\end{figure}

Despite in Gaussian mixtures, the theoretical invariance of the maximum of the likelihood function wherever the part removed, we stated that in practice the numerical algorithm gets stuck in a local optimum. That is, the invariance of the results is not guaranteed, and different mixture may be obtained depending on the part removed. 

To set a Dirichlet distribution in $\mathcal{S}^D$ it is necessary to specify its parameters $\left( \alpha^1, \dots ,\alpha^D \right)$. Therefore, to fit a mixture of $K$ Dirichlet distributions it is necessary to estimate the parameters $\pi_1$, \dots, $\pi_K$ and $\left( \alpha^1_1, \dots ,\alpha^D_1 \right), \dots, \left( \alpha^1_K, \dots, \alpha^D_K \right)$. Fitting the parameters of a Dirichlet mixture we approximated the MLE estimator of a Dirichlet mixture using the classification EM-algorithm proposed by \cite{celeux1992classification}. The mixture of dirichlet distributions $
\pi_1 f(\;\cdot\; ; \alpha_1) + \pi_2 f(\;\cdot\; \alpha_2) + \pi_3 f(\;\cdot\; ; \alpha_3)
$
obtained has the parameters
{\small \input{tex/pars_dirichlet_mixture.tex} }


Figure~\ref{fig06fittingdirichlet} shows how a Dirichlet mixture fits the data set. Note that the estimated Dirichlet mixture is not be able to capture the structure of dependence between the three chemical elements, the three groups are not correctly detected. 

\begin{figure}[htbp]
\centering
\includegraphics[width=0.95\textwidth]{figures/dirichlet_mixture.pdf}
\caption{Reduced Forensic Glass data set: classification given by a standard Dirichlet mixture model. Three different groups of glasses: containers (circles), headlamps (triangles) and vehicle windows (squares)}
\label{fig06fittingdirichlet}
\end{figure}

To fit a mixture of log-ratio distributions it is necessary first to express each composition with respect to a basis of $\mathcal{S}^3$. Consider the basis 
\[
\mathcal{B} = \left\{ C\Big( e^{1/\sqrt{2}}, 1/e^{\sqrt{1/2}}, 1 \Big), \; C\Big( e^{1/\sqrt{6}}, e^{1/\sqrt{6}}, 1/e^{\sqrt{2/3}} \Big) \right\}.
\]

Table~\ref{example_glasses} contains the data set expressed in log-ratio coordinates with respect to basis $\mathcal{B}$, resulting in coordinates $h_1 = \sqrt{1/2} \ln(\text{Ca}/\text{Si})$ and $h_2 = \sqrt{2/3} \ln(\sqrt{\text{Ca} \cdot \text{Si}} / \text{Al})$.



Fitting a Gaussian mixture to the coordinates results in mixture model
$
\pi_1 f_{\mathcal{B}}(\cdot\;; \mu_1, \Sigma_1) + \pi_2 f_{\mathcal{B}}(\cdot\;; \mu_2, \Sigma_2) + \pi_3 f_{\mathcal{B}}(\cdot\;; \mu_3, \Sigma_3)
$
with parameters

{\small \input{tex/pars_coda_gaussian_mixture.tex} }

Note that, although mixture model is defined on the simplex, its parameters are defined with respect to coordinates $h_1$ and $h_2$. In Figure~\ref{fig07fittingcodaGaussian} the isocurves of density are represented in the space
of coordinates (left) and in the ternary diagram (right).

\begin{figure}[htbp]
\centering
\includegraphics[width=\textwidth]{figures/coda_gaussian_mixture.pdf}\\
\caption{Log-ratio Gaussian mixtures for Forensic Glass data set: (left) in coordinates; (right) in the ternary diagram.}
\label{fig07fittingcodaGaussian}
\end{figure}



Following an analogous approach, it is possible to fit other non-gaussian models. For example in Figure~\ref{othercodadist} the dataset is modelled with a mixture of multivariate skew-normal distributions as defined in \citep{prates2013mixsmsn}, an with a mixture of multivariate skew-$t$ normal distributions as defined in \citep{mclachlan2013emmixuskew}.


\begin{figure}[htbp]
\centering
\includegraphics[width=0.8\textwidth]{figures/coda_skew_mixture.pdf}\\%{fig07_coda_skew_mixture2.pdf}
\includegraphics[width=0.8\textwidth]{figures/coda_skew_t_mixture.pdf}%{fig07_coda_skew_mixture2.pdf}
\caption{Compositional mixtures for Forensic Glass data set: (top-left) log-ratio coordinates of the mixture of multivariate skew normal distributions; (top-right) the same mixture represented in a ternary diagram; (bottom-left) log-ratio coordinates of the mixture of multivariate $t$-skew distributions; (bottom-right) the same mixture represented in a ternary diagram.}
\label{othercodadist}
\end{figure}


\section{Conclusions}
\label{conclusion_section}
Traditional distributions in finite mixtures for compositional data sets show important difficulties. If densities for real data are used, probabilities to impossible events are obtained and the results depend on the removed part. Dirichlet density and some generalizations on the simplex can not capture the variability of many compositional data sets due to its strong independence structure. Log-ratio distributions are flexible models that could describe different form of variability and dependence structures. Indeed, any mixture model defined on the real space can be used to model data on the simplex space using the principle of working on coordinates. In particular, we have introduced the methodology to fit a mixture of normal skew-normal and skew-$t$ distributions to the log-ratio coordinates of a compositional sample. This three options extend the range of possibilities we have up to now with the Dirichlet model or generalizations. The log-ratio normal distribution provides a rich enough parametric class of distributions on the appropriate sample space. 

\section*{Acknowledgments}
This research was supported by the Ministerio de Econom\'ia y Competividad under the project
``METRICS'' Ref. MTM2012-33236 and the Agència de Gestió d'Ajuts Universitaris i de Recerca (AGAUR), Generalitat de Catalunya (Ref: 2014SGR551).

%\section*{References}

\bibliographystyle{apalike}
\bibliography{tex/compositional_mixtures}{}

\newpage
\appendix
\section{Basis invariance}

\begin{definition}
Let $\mathcal{B}_1$ and $\mathcal{B}_2$ be orthonormal basis. Let $\Theta$ be a parameter space for a probability density function $f^*: \mathbb{R}^d \rightarrow \mathbb{R}^+$. 
A probability density function $f^*$ is \emph{basis invariant} if for any two different othonormal basis $\mathcal{B}_1$, $\mathcal{B}_2$, for any parameter $\theta_1 \in \Theta$, there is a parameter $\theta_2 \in \Theta$ such that
\[
f^*(h_{\mathcal{B}_1}(\textbf{x}); \theta_1) = f^*(h_{\mathcal{B}_2}(\textbf{x}); \theta_2).
\]

\end{definition}


% \begin{prop}
% Let $\mathcal{B}$ be an orthonormal basis. Let $\Theta$ be a parameter space for a probability density function $f^*: \mathbb{R}^d \rightarrow \mathbb{R}^+$.
% 
% If for any orthogonal matrix $Q$ and $\theta_\mathcal{B} \in \Theta$ there is a parameter $\theta \in \Theta$ such that 
% \[
% \forall \textbf{x} \in \mathcal{S}^D, \;\; f^*(h_\mathcal{B}(\textbf{x}) \cdot Q ;\; \theta) = f^*(h_\mathcal{B}(\textbf{x});\; \theta_\mathcal{B}),
% \]
% the the probability function $f^*$ is basis invariant.
% \end{prop}

\end{document}

\endinput 
